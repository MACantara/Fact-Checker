{% extends "base.html" %}

{% block title %}Check Fake News - Philippine News Search Engine{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">
                üîç Fake News Detector
            </h1>
            <p class="text-gray-600">
                Analyze news content to determine if it's likely fake or real
            </p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-6">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-3">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Analysis Form -->
        <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
            <form method="POST" id="analysisForm">
                <!-- Method Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Analysis Method</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="method" value="text" class="mr-2" checked onchange="toggleInputMethod()">
                            <span>üìù Text Input</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="method" value="url" class="mr-2" onchange="toggleInputMethod()">
                            <span>üåê URL Input</span>
                        </label>
                    </div>
                </div>

                <!-- Text Input Section -->
                <div id="textInput" class="input-section">
                    <div class="mb-4">
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                            Article Title (Optional)
                        </label>
                        <input type="text" 
                               id="title" 
                               name="title" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Enter the news article title...">
                    </div>

                    <div class="mb-4">
                        <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                            Article Content <span class="text-red-500">*</span>
                        </label>
                        <textarea id="content" 
                                  name="content" 
                                  rows="8" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  placeholder="Paste the news article content here..."></textarea>
                        <div class="text-sm text-gray-500 mt-1">
                            <span id="charCount">0</span> characters
                        </div>
                    </div>
                </div>

                <!-- URL Input Section -->
                <div id="urlInput" class="input-section hidden">
                    <div class="mb-4">
                        <label for="url" class="block text-sm font-medium text-gray-700 mb-2">
                            Article URL <span class="text-red-500">*</span>
                        </label>
                        <input type="url" 
                               id="url" 
                               name="url" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="https://example.com/news-article">
                        <div class="text-sm text-gray-500 mt-1">
                            We'll automatically extract the title and content from the URL
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit" 
                            id="analyzeBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition duration-200 flex items-center">
                        <span id="btnText">üîç Analyze Article</span>
                        <div id="spinner" class="hidden ml-2">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                        </div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Sample Text Examples -->
        <div class="bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-4">üìù Try These Examples</h3>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-medium text-green-600 mb-2">Example: Likely Real News</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        "Philippine GDP Growth Reaches 6.2% in Q3. The Philippines recorded a 6.2% gross domestic product growth in the third quarter, driven by strong consumer spending and infrastructure investments, according to the Philippine Statistics Authority."
                    </p>
                    <button onclick="fillExample(1)" class="text-blue-600 hover:text-blue-800 text-sm underline">
                        Use This Example
                    </button>
                </div>
                
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-medium text-red-600 mb-2">Example: Likely Fake News</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        "Scientists Discover Cure for All Diseases. A team of researchers has discovered a miracle pill that can cure all known diseases in just 24 hours. The pill is made from a rare plant found only in the Amazon rainforest."
                    </p>
                    <button onclick="fillExample(2)" class="text-blue-600 hover:text-blue-800 text-sm underline">
                        Use This Example
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleInputMethod() {
    const textRadio = document.querySelector('input[name="method"][value="text"]');
    const urlRadio = document.querySelector('input[name="method"][value="url"]');
    const textInput = document.getElementById('textInput');
    const urlInput = document.getElementById('urlInput');
    
    if (textRadio.checked) {
        textInput.classList.remove('hidden');
        urlInput.classList.add('hidden');
        document.getElementById('content').required = true;
        document.getElementById('url').required = false;
    } else {
        textInput.classList.add('hidden');
        urlInput.classList.remove('hidden');
        document.getElementById('content').required = false;
        document.getElementById('url').required = true;
    }
}

function fillExample(exampleNum) {
    document.querySelector('input[name="method"][value="text"]').checked = true;
    toggleInputMethod();
    
    if (exampleNum === 1) {
        document.getElementById('title').value = 'Philippine GDP Growth Reaches 6.2% in Q3';
        document.getElementById('content').value = 'The Philippines recorded a 6.2% gross domestic product growth in the third quarter, driven by strong consumer spending and infrastructure investments, according to the Philippine Statistics Authority. The growth exceeded expectations and puts the country on track to meet its annual target. Key sectors contributing to the growth include services, industry, and agriculture. Consumer confidence remains high, and foreign investments continue to flow into the country.';
    } else if (exampleNum === 2) {
        document.getElementById('title').value = 'Scientists Discover Cure for All Diseases';
        document.getElementById('content').value = 'A team of researchers has discovered a miracle pill that can cure all known diseases in just 24 hours. The pill is made from a rare plant found only in the Amazon rainforest. According to the lead scientist, the discovery will revolutionize medicine and eliminate all human suffering. The pill has allegedly been tested on thousands of patients with 100% success rate, curing everything from cancer to diabetes instantly.';
    }
    updateCharCount();
}

function updateCharCount() {
    const content = document.getElementById('content').value;
    document.getElementById('charCount').textContent = content.length;
}

// Character counter
document.getElementById('content').addEventListener('input', updateCharCount);

// Form submission handling
document.getElementById('analysisForm').addEventListener('submit', function(e) {
    const analyzeBtn = document.getElementById('analyzeBtn');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btnText');
    
    // Show loading state
    analyzeBtn.disabled = true;
    spinner.classList.remove('hidden');
    btnText.textContent = '‚è≥ Analyzing...';
});

// Initialize
updateCharCount();
</script>
{% endblock %}
